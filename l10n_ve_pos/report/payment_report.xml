<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="payment_report_pos">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">
                <t t-set="docs" t-value="docs.browse(config_ids)"/>
                <t t-if="type_report == 'by_cash_register'">
                    <t t-foreach="docs" t-as="o">
                        <t t-call="l10n_ve_pos.table_payment_report_pos"/>
                    </t>
                </t>
                <t t-else="">
                    <t t-set="e" t-value="docs"/>
                    <t t-call="l10n_ve_pos.table_payment_report_pos_general"/>
                </t>
            </t>
        </t>
    </template>
    <template id="table_payment_report_pos">
        <t t-set="payments" t-value="get_info(o)['payments']"/>
        <t t-set="payment_methods" t-value="get_info(o)['payment_methods']"/>
        <t t-set="categories" t-value="get_info(o)['categories']"/>
        <t t-set="group_categories" t-value="get_info(o)['group_categories']"/>
        <div class="mt-5">
            <div class="page" style="page-break-after: always">
                <h3 class="text-center">
                    <t t-out="o.name if type_report == 'by_cash_register' else 'Todas las Cajas'"/> -
                    <t t-out="range_date"/>
                </h3>
                <table class="table table-sm" >
                    <thead>
                        <tr>
                            <th class="col-4">Moneda</th>
                            <th class="col-2">Cantidad</th>
                            <th class="text-end" t-out="foreign_currency.symbol"></th>
                            <th class="text-end" t-out="currency.symbol">$</th>
                            <th class="col-2">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="sales" t-value="get_payment_info(get_info(o)['all_payments'])"/>
                        <tr>
                            <td >Ventas</td>
                            <td class="text-center" t-out="sales['sale_count']"></td>
                            <td class="text-end" t-out="sales['f_foreign_amount']"></td>
                            <td class="text-end" t-out="sales['f_amount']"></td>
                            <td class="text-end" t-out="get_info(o)['get_percentage'](sales['amount'])"></td>
                        </tr>
                        <tr class="bg-light">
                            <td>Formas de Pago</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['global'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['global'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(o)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr class="bg-light">
                            <td>Distribuci√≥n del Reporte</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FISCAL</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['fiscal'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['fiscal'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(o)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr>
                            <td>NOTAS</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['no_fiscal'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['no_fiscal'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(o)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr class="bg-light">
                            <td>Categoria</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="categories" t-as="category">
                            <t t-if="group_categories.get(category['id'], False)">
                                <t t-set="info" t-value="get_category_info(group_categories[category['id']])"/>
                                <tr>
                                    <td t-out="category['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(o)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </template>
    <template id="table_payment_report_pos_general">
        <t t-set="payments" t-value="get_info(e)['payments']"/>
        <t t-set="payment_methods" t-value="get_info(e)['payment_methods']"/>
        <t t-set="categories" t-value="get_info(e)['categories']"/>
        <t t-set="group_categories" t-value="get_info(e)['group_categories']"/>
        <div class="mt-5">
            <div class="page" style="page-break-after: always">
                <h3 class="text-center">
                    <t t-out="o.name if type_report == 'by_cash_register' else 'Todas las Cajas'"/> -
                    <t t-out="date_start"/> -
                    <t t-out="date_stop"/>
                </h3>
                <table class="table table-sm" >
                    <thead>
                        <tr>
                            <th class="col-4">Moneda</th>
                            <th class="col-2">Cantidad</th>
                            <th class="text-end" t-out="foreign_currency.symbol"></th>
                            <th class="text-end" t-out="currency.symbol">>$</th>
                            <th class="col-2">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="sales" t-value="get_payment_info(get_info(e)['all_payments'])"/>
                        <tr>
                            <td >Ventas</td>
                            <td class="text-center" t-out="sales['sale_count']"></td>
                            <td class="text-end" t-out="sales['f_foreign_amount']"></td>
                            <td class="text-end" t-out="sales['f_amount']"></td>
                            <td class="text-end" t-out="get_info(e)['get_percentage'](sales['amount'])"></td>
                        </tr>
                        <tr class="bg-light">
                            <td>Formas de Pago</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['global'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['global'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(e)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr class="bg-light">
                            <td>Distribuci√≥n del Reporte</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FISCAL</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['fiscal'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['fiscal'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(e)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr>
                            <td>NOTAS</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="payment_methods" t-as="payment_method">
                            <t t-if="payments['no_fiscal'].get(payment_method['id'], False)">
                                <t t-set="info" t-value="get_payment_info(payments['no_fiscal'][payment_method['id']])"/>
                                <tr>
                                    <td t-out="payment_method['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(e)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                        <tr class="bg-light">
                            <td>Categoria</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <t t-foreach="categories" t-as="category">
                            <t t-if="group_categories.get(category['id'], False)">
                                <t t-set="info" t-value="get_category_info(group_categories[category['id']])"/>
                                <tr>
                                    <td t-out="category['name']" />
                                    <td class="text-center"></td>
                                    <td class="text-end" t-out="info['f_foreign_amount']"></td>
                                    <td class="text-end" t-out="info['f_amount']"></td>
                                    <td class="text-end" t-out="get_info(e)['get_percentage'](info['amount'])"></td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </template>
    <data noupdate="1">
        <record id="paperformat_payment_report" model="report.paperformat">
            <field name="name">Payment Report</field>
            <field name="default" eval="True"/>
            <field name="format">Letter</field>
            <!--<field name="page_height">154</field>
            <field name="page_width">210</field>-->
            <field name="orientation">Portrait</field>
            <field name="margin_top">20</field>
            <field name="margin_bottom">20</field>
            <field name="margin_left">8</field>
            <field name="margin_right">8</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">3</field>
            <field name="dpi">90</field>
        </record>
    </data>
    <record id="action_payment_report_pos" model="ir.actions.report">
        <field name="name">Payment Report</field>
        <field name="model">pos.config</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">l10n_ve_pos.payment_report_pos</field>
        <field name="report_file">l10n_ve_pos.payment_report_pos</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_config"/>
        <field name="binding_type">report</field>
        <field name="print_report_name" >'Payment Report.pdf'</field>
        <field name="paperformat_id" ref="l10n_ve_pos.paperformat_payment_report"/>
    </record>
</odoo>