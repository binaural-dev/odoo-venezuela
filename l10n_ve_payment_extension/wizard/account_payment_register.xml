<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="account_payment_register_form_l10n_ve_payment_extension" model="ir.ui.view">
            <field name="name">account.payment.register.form</field>
            <field name="model">account.payment.register</field>
            <field name="inherit_id" ref="account.view_account_payment_register_form"/>
            <field name="arch" type="xml">
		<field name="journal_id" position="attributes">
		    <attribute name="attrs">{'readonly': [('edit_retention_fields', '=', False)]}</attribute>
		</field>
		<field name="foreign_rate" position="attributes">
		    <attribute name="attrs">{'readonly': [('edit_retention_fields', '=', False)]}</attribute>
		</field>
		<field name="journal_id" position="before">
                    <field name="is_retention" attrs="{'invisible': [('is_out_invoice', '=', False)]}"/>
		</field>
				
				<field name="amount" position="attributes">
					<attribute name="attrs">{'readonly': [('is_retention', '=', True)]}</attribute>
				</field>

				<field name="currency_id" position="attributes">
					<attribute name="attrs">{'readonly': [('is_retention', '=', True)]}</attribute>
				</field>

                <group name="group2" position="after">
		    <!-- Invisible fields -->
		    <field name="edit_retention_fields" invisible="1"/>
		    <field name="base_currency_is_vef" invisible="1"/>
		    <field name="is_out_invoice" invisible="1"/>
			<field name="journal_id" invisible="1"/>

		    <div attrs="{'invisible':[('is_retention', '=', False)]}">
			<label for="voucher_date"/>
			<field name="voucher_date" attrs="{'required':[('is_retention', '=', True)]}"/>

		    	<label for="retention_ref" />
		    	<field name="retention_ref" attrs="{'required':[('is_retention', '=', True)]}"/>
	    	    </div>

                    <notebook attrs="{'invisible':[('is_retention', '=', False)]}">
                        <page name="retention_lines" string="Retention lines">
                            <field name="retention_line_ids" nolabel="1">
                                <tree editable="bottom">
				    <!-- Invisible fields -->
                                    <field name="invoice_type" invisible="1"/>
				    <field name="company_currency_id" invisible="1"/>
				    <field name="foreign_currency_id" invisible="1"/>
				    <field name="foreign_currency_rate" invisible="1"/>

                                    <field name="name"/>
				    <field name="move_id"/>
                                    <field name="aliquot"/>
				    <field name="related_percentage_tax_base" optional="hide"/>
				    <!-- Amounts -->
				    <field
					name="invoice_total"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', False)]}"
				    />
				    <field
					name="invoice_amount"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', False)]}"
				    />
				    <field
					name="iva_amount"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', False)]}"
				    />
				    <field
					name="retention_amount"
					widget="monetary"
				    />
				    <!-- Foreign Amounts -->
				    <field
					name="foreign_invoice_amount"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', True)]}"
				    />
				    <field
					name="foreign_iva_amount"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', True)]}"
				    />
				    <field
					name="foreign_invoice_total"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', True)]}"
				    />
				    <field
					name="foreign_retention_amount"
					widget="monetary"
					attrs="{'column_invisible': [('parent.base_currency_is_vef', '=', True)]}"
				    />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </group>

		<group name="group3" position="attributes">
		    <attribute name="attrs">
			{
			    'invisible': [
			    	'|', ('edit_retention_fields', '=', False),
			    	'|', ('payment_difference', '=', 0.0),
				'|', ('can_edit_wizard', '=', False),
			    	'&amp;', ('can_group_payments', '=', True),
			    	('group_payment', '=', False),
			    ]
			}
		    </attribute>
		</group>
            </field>
        </record>
    </data>
</odoo>
